<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è‚¡ç¥¨åƒ¹å€¼æŠ•è³‡ç­–ç•¥ - å¯¦æ™‚æ±ºç­–ç‰ˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #ffffff; color: #374151; }
        .card { border: 1px solid #e5e7eb; border-radius: 8px; background: white; padding: 20px; }
        .status-dot { height: 8px; width: 8px; border-radius: 50%; display: inline-block; margin-right: 6px; }
        .pulse { animation: pulse-animation 2s infinite; }
        @keyframes pulse-animation { 0% { opacity: 1; } 50% { opacity: 0.4; } 100% { opacity: 1; } }
    </style>
</head>
<body class="p-6">

    <header class="max-w-6xl mx-auto flex justify-between items-center mb-8 border-b pb-4">
        <div>
            <h1 class="text-2xl font-bold tracking-tight text-slate-800">è‚¡ç¥¨åƒ¹å€¼æŠ•è³‡ç­–ç•¥ <span class="text-sm font-normal text-slate-400">v2.1</span></h1>
            <p class="text-sm text-slate-500 flex items-center">
                <span class="status-dot bg-emerald-500 pulse"></span> å¯¦æ™‚è¡Œæƒ…åŒæ­¥ä¸­ (RSI < 20 ç­–ç•¥å·²å•Ÿå‹•)
            </p>
        </div>
        <div class="text-right">
            <button onclick="refreshData()" class="text-xs bg-slate-100 hover:bg-slate-200 px-3 py-1 rounded text-slate-600 transition">
                <i class="fa-solid fa-rotate mr-1"></i> æ‰‹å‹•åˆ·æ–°
            </button>
            <p id="last-update" class="text-xs text-slate-400 mt-1"></p>
        </div>
    </header>

    <main class="max-w-6xl mx-auto grid grid-cols-1 lg:grid-cols-3 gap-6">
        
        <div class="space-y-6">
            <div class="card bg-slate-50 border-none">
                <h2 class="text-sm font-semibold text-slate-600 mb-3"><i class="fa-regular fa-newspaper mr-2"></i> ç”¢æ¥­æƒ…å ±</h2>
                <div id="news-feed" class="text-sm text-slate-600 space-y-2">
                    <p>æ­£åœ¨ç²å–æœ€æ–°é‡é›»ç”¢æ¥­æ–°è...</p>
                </div>
            </div>

            <div class="card">
                <h2 class="text-sm font-semibold text-slate-600 mb-4">æ‰‹å‹•æŒè‚¡ç®¡ç†</h2>
                <div class="space-y-4">
                    <input id="stock-id" type="text" placeholder="ä»£è™Ÿ (å¦‚: 1513)" class="w-full border p-2 rounded text-sm">
                    <input id="stock-qty" type="number" placeholder="å¼µæ•¸" class="w-full border p-2 rounded text-sm">
                    <input id="stock-price" type="number" placeholder="è²·é€²åƒ¹æ ¼" class="w-full border p-2 rounded text-sm">
                    <button onclick="addStock()" class="w-full bg-slate-800 text-white py-2 rounded text-sm hover:bg-slate-700">åŠ å…¥åˆ†æ</button>
                </div>
            </div>
        </div>

        <div class="lg:col-span-2 space-y-6">
            <div class="card">
                <h2 class="text-sm font-semibold text-slate-600 mb-4">åƒ¹å€¼è©•ä¼°ï¼šå€‹è‚¡ vs ç”¢æ¥­ P/E</h2>
                <canvas id="peChart" height="100"></canvas>
            </div>

            <div class="card overflow-x-auto">
                <h2 class="text-sm font-semibold text-slate-600 mb-4">åº«å­˜åˆ†æ (é€²å ´æ¢ä»¶: RSI < 20)</h2>
                <table class="w-full text-left text-sm">
                    <thead>
                        <tr class="border-b text-slate-400 text-xs uppercase">
                            <th class="py-2">ä»£è™Ÿ</th>
                            <th class="py-2">å¯¦æ™‚åƒ¹</th>
                            <th class="py-2">æç›Š %</th>
                            <th class="py-2">RSI</th>
                            <th class="py-2">ç­–ç•¥å»ºè­°</th>
                        </tr>
                    </thead>
                    <tbody id="portfolio-body"></tbody>
                </table>
            </div>
        </div>
    </main>

    <script>
        // --- è€å¸«çš„æ•¸æ“šå¼•æ“ ---
        let marketData = {
            "1513": { name: "ä¸­èˆˆé›»", price: 185.5, pe: 24.2, industryPe: 35.0, rsi: 22, chipDays: 4, ma20: 175 },
            "1519": { name: "è¯åŸ", price: 1015.0, pe: 72.5, industryPe: 35.0, rsi: 18, chipDays: 3, ma20: 980 },
            "2308": { name: "å°é”é›»", price: 420.0, pe: 28.5, industryPe: 32.0, rsi: 19, chipDays: 5, ma20: 400 }
        };

        let portfolio = [];
        let peChart;

        // 1. è‡ªå‹•æ›´æ–°è‚¡åƒ¹æ¨¡æ“¬å™¨ (æ¯ 5 ç§’éš¨æ©Ÿè·³å‹•ï¼Œæ¨¡æ“¬çœŸå¯¦å¸‚å ´)
        function simulateMarket() {
            for (let id in marketData) {
                let change = (Math.random() - 0.5) * 2; // éš¨æ©Ÿéœ‡ç›ª
                marketData[id].price = parseFloat((marketData[id].price + change).toFixed(1));
                // éš¨æ©Ÿè®Šå‹• RSI è®“ä½ èƒ½çœ‹åˆ°è¨Šè™Ÿè§¸ç™¼
                marketData[id].rsi = Math.floor(Math.random() * 40) + 10; 
            }
            renderPortfolio();
            document.getElementById('last-update').innerText = "æœ€å¾Œæ›´æ–°: " + new Date().toLocaleTimeString();
        }

        // 2. èª¿æ•´å¾Œçš„æ ¸å¿ƒé‚è¼¯ (RSI < 20)
        function renderPortfolio() {
            const body = document.getElementById('portfolio-body');
            body.innerHTML = '';

            portfolio.forEach(s => {
                const liveData = marketData[s.id];
                const pnl = (((liveData.price - s.buyPrice) / s.buyPrice) * 100).toFixed(2);
                
                let advice = "ğŸŸ¡ çºŒæŠ±è§€å¯Ÿ";
                let adviceColor = "text-slate-400";

                // å‡ºå ´é‚è¼¯
                if (pnl > 20 || liveData.price < liveData.ma20) {
                    advice = "âš ï¸ å»ºè­°å‡ºå ´";
                    adviceColor = "text-rose-600 font-bold";
                } 
                // é€²å ´æ¢ä»¶å„ªåŒ–ï¼šRSI < 20 (ä½ è¦æ±‚çš„æ¢ä»¶)
                else if (liveData.rsi < 20 && liveData.pe < liveData.industryPe) {
                    advice = "ğŸ”¥ å¼·åŠ›åƒ¹å€¼è²·é»";
                    adviceColor = "text-emerald-600 font-bold";
                }

                body.innerHTML += `
                    <tr class="border-b">
                        <td class="py-4 font-bold text-slate-700">${s.id}</td>
                        <td class="py-4">${liveData.price}</td>
                        <td class="py-4 ${pnl >= 0 ? 'text-emerald-600' : 'text-rose-600'}">${pnl}%</td>
                        <td class="py-4">${liveData.rsi}</td>
                        <td class="py-4 ${adviceColor}">${advice}</td>
                    </tr>
                `;
            });
        }

        function addStock() {
            const id = document.getElementById('stock-id').value;
            const qty = document.getElementById('stock-qty').value;
            const buyPrice = document.getElementById('stock-price').value;

            if (marketData[id]) {
                portfolio.push({ id, qty, buyPrice });
                renderPortfolio();
                updateChart();
            } else {
                alert("ç›®å‰æ¸¬è©¦ä»£ç¢¼æ”¯æ´ï¼š1513, 1519, 2308");
            }
        }

        function updateChart() {
            const ctx = document.getElementById('peChart').getContext('2d');
            const labels = portfolio.map(p => p.id);
            if (peChart) peChart.destroy();
            peChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [
                        { label: 'å€‹è‚¡ PE', data: portfolio.map(p => marketData[p.id].pe), backgroundColor: '#334155' },
                        { label: 'ç”¢æ¥­å¹³å‡', data: portfolio.map(p => marketData[p.id].industryPe), backgroundColor: '#cbd5e1' }
                    ]
                },
                options: { responsive: true, scales: { y: { beginAtZero: true } } }
            });
        }

        // å•Ÿå‹•å®šæ™‚å™¨
        setInterval(simulateMarket, 5000); 
        document.getElementById('news-feed').innerHTML = "<p>â€¢ NVIDIA å†æ¬¡ä¸Šèª¿é›»ç¶² AI æ™¶ç‰‡éœ€æ±‚ç›®æ¨™ã€‚<br>â€¢ å°ç£ 2026 å¼·éŸŒé›»ç¶²é ç®—åŠ ç¢¼ 10%ã€‚</p>";
    </script>
</body>
</html>